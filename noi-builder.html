<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NOI Builder | CRE Tool Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5TV8E0CCL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N5TV8E0CCL');
    </script>

    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
      .tooltip { position: relative; display: inline-block; }
      .tooltip .tooltip-text { visibility: hidden; width: 250px; background-color: #333; color: #fff; text-align: left; border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -125px; opacity: 0; transition: opacity 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-size: 0.875rem; line-height: 1.25rem; font-weight: normal; }
      .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
      .tooltip .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      // --- Shared Components ---
      const HeaderAndNav = ({ activePage }) => {
        const [isMenuOpen, setIsMenuOpen] = useState(false);
        const navLinks = [ { name: 'Home', href: 'index.html' }, { name: 'Calculators', href: 'cap-rate-calculator.html' }, { name: 'Blog', href: '#' }, { name: 'About', href: '#' } ];
        const linkClasses = (page) => `px-3 py-2 rounded-md text-sm font-medium transition-colors ${ activePage === page.name ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100' }`;
        return (
            <header className="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
                <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                        <div className="flex items-center">
                            <div className="flex-shrink-0"><a href="index.html" className="text-xl font-bold text-blue-600">CRE Tool Hub</a></div>
                        </div>
                        <div className="hidden md:block">
                            <div className="ml-10 flex items-baseline space-x-4">
                                {navLinks.map(link => <a key={link.name} href={link.href} className={linkClasses(link)}>{link.name}</a>)}
                            </div>
                        </div>
                        <div className="-mr-2 flex md:hidden">
                            <button onClick={() => setIsMenuOpen(!isMenuOpen)} type="button" className="bg-gray-100 inline-flex items-center justify-center p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-200 focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                                <span className="sr-only">Open main menu</span>
                                {!isMenuOpen ? (<svg className="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>) : (<svg className="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>)}
                            </button>
                        </div>
                    </div>
                </div>
                {isMenuOpen && (<div className="md:hidden" id="mobile-menu"><div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">{navLinks.map(link => <a key={link.name} href={link.href} className={`block ${linkClasses(link)}`}>{link.name}</a>)}</div></div>)}
            </header>
        );
      };
      const Footer = () => (
        <footer className="bg-white border-t border-gray-200"><div className="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-gray-500"><p className="text-xs max-w-3xl mx-auto"><strong>Disclaimer:</strong> CRE Tool Hub provides educational calculators for informational purposes only. This is not financial, investment, or legal advice. Consult qualified professionals before making investment decisions.</p><div className="mt-4 flex justify-center space-x-4 text-xs"><a href="#" className="hover:text-gray-700">Privacy Policy</a><span>&middot;</span><a href="#" className="hover:text-gray-700">Terms of Use</a><span>&middot;</span><a href="#" className="hover:text-gray-700">Contact</a></div><p className="mt-4 text-xs">&copy; {new Date().getFullYear() + 1} CRE Tool Hub. All rights reserved.</p></div></footer>
      );
      const InfoTooltip = ({ text }) => (<span className="tooltip ml-1 text-gray-400 cursor-help"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span className="tooltip-text">{text}</span></span>);
      const AdPlaceholder = ({ widthClass, heightClass }) => (<div className={`bg-gray-100 flex items-center justify-center mx-auto rounded-md border-2 border-dashed border-gray-300 ${widthClass} ${heightClass}`}><div className="text-center"><span className="text-gray-500 text-sm block">Advertisement</span></div></div>);
      const AffiliateCard = ({ title, description, cta }) => (<div className="border border-gray-200 bg-white rounded-lg p-4 flex flex-col md:flex-row justify-between items-center space-y-3 md:space-y-0 md:space-x-4"><div className="text-center md:text-left"><h4 className="font-semibold text-gray-800">{title}</h4><p className="text-sm text-gray-500">{description}</p></div><button className="bg-blue-600 text-white hover:bg-blue-700 text-sm font-semibold py-2 px-4 rounded-md transition-colors w-full md:w-auto flex-shrink-0">{cta}</button></div>);
      const AccordionItem = ({ question, answer }) => {
        const [isOpen, setIsOpen] = useState(false);
        return (<div className="py-4"><button onClick={() => setIsOpen(!isOpen)} className="w-full flex justify-between items-center text-left text-gray-800 focus:outline-none"><span className="font-semibold">{question}</span><svg className={`w-5 h-5 transform transition-transform duration-200 ${isOpen ? 'rotate-180' : 'rotate-0'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg></button>{isOpen && (<div className="mt-3 text-gray-600 prose max-w-none"><p>{answer}</p></div>)}</div>);
      };
      
      const NoiBuilder = ({ grossRent, setGrossRent, vacancy, setVacancy, otherIncome, setOtherIncome, opEx, setOpEx, noi }) => {
        const [showFormula, setShowFormula] = useState(false);
        const [copyStatus, setCopyStatus] = useState(false);

        const handleShare = () => {
            const params = new URLSearchParams();
            params.set('tool', 'noi');
            params.set('rent', grossRent);
            params.set('vacancy', vacancy);
            params.set('other', otherIncome);
            params.set('opex', opEx);
            const newUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
            navigator.clipboard.writeText(newUrl).then(() => {
                setCopyStatus(true);
                setTimeout(() => setCopyStatus(false), 2000);
            });
        };
        
        const calculateNoi = (gpr, vac, other, opex) => gpr - vac + other - opex;

        const sensitivity = useMemo(() => {
            const numGrossRent = parseFloat(grossRent) || 0;
            const numVacancy = parseFloat(vacancy) || 0;
            const numOtherIncome = parseFloat(otherIncome) || 0;
            const numOpEx = parseFloat(opEx) || 0;
            return {
                rentMinus10: calculateNoi(numGrossRent * 0.9, numVacancy, numOtherIncome, numOpEx),
                rentPlus10: calculateNoi(numGrossRent * 1.1, numVacancy, numOtherIncome, numOpEx),
                opExMinus10: calculateNoi(numGrossRent, numVacancy, numOtherIncome, numOpEx * 0.9),
                opExPlus10: calculateNoi(numGrossRent, numVacancy, numOtherIncome, numOpEx * 1.1),
            }
        }, [grossRent, vacancy, otherIncome, opEx]);

        return (
          <div className="p-4 md:p-6 bg-white border border-gray-200 rounded-lg">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
              <div className="space-y-3">
                <div>
                  <label className="block text-sm font-medium text-gray-600">Gross Potential Rent <InfoTooltip text="Total annual rental income if all units were occupied 100% of the time." /></label>
                  <input type="number" value={grossRent} onChange={e => setGrossRent(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-600">Vacancy Loss (-) <InfoTooltip text="Estimated income lost due to unoccupied units. Often calculated as a percentage of Gross Potential Rent (e.g., 5%)." /></label>
                  <input type="number" value={vacancy} onChange={e => setVacancy(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-600">Other Income (+) <InfoTooltip text="Additional income from sources like parking fees, laundry, vending machines, or late fees." /></label>
                  <input type="number" value={otherIncome} onChange={e => setOtherIncome(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-600">Operating Expenses (-) <InfoTooltip text="All costs to run the property, including property taxes, insurance, maintenance, utilities, and management fees. Excludes debt payments." /></label>
                  <input type="number" value={opEx} onChange={e => setOpEx(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2 px-3"/>
                </div>
              </div>
              <div className="mt-4 md:mt-0 md:ml-6 flex flex-col items-center justify-center bg-gray-50 p-6 rounded-lg shadow-inner h-full">
                <span className="text-sm font-medium text-gray-500">Net Operating Income (NOI)</span>
                <p className="text-4xl md:text-5xl font-bold text-blue-600 my-1">{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(noi)}</p>
                <p className="text-xs text-gray-400">Formula: (GPR - Vacancy + Other) - OpEx</p>
              </div>
            </div>
            <div className="mt-6 flex flex-col md:flex-row gap-3">
                <button onClick={handleShare} className="bg-blue-600 text-white hover:bg-blue-700 text-sm font-semibold py-2 px-4 rounded-md transition-colors flex-1">{copyStatus ? 'Link Copied!' : 'Share This Calculation'}</button>
                <button onClick={() => setShowFormula(!showFormula)} className="bg-gray-200 text-gray-700 hover:bg-gray-300 text-sm font-semibold py-2 px-4 rounded-md transition-colors flex-1">{showFormula ? 'Hide' : 'Show'} Formula & Sensitivity</button>
            </div>
            {showFormula && (<div className="mt-4 bg-blue-50 border-l-4 border-blue-300 p-4 rounded-md text-sm text-gray-800 space-y-3"><p><strong className="font-semibold">Formula:</strong> NOI = (Gross Rent - Vacancy + Other Income) - Operating Expenses</p><div><strong className="font-semibold">Sensitivity Analysis (±10%):</strong><ul className="list-disc list-inside mt-1 text-gray-700"><li><strong>Base NOI:</strong> {new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(noi)}</li><li>If Gross Rent changes: -10% → ${sensitivity.rentMinus10.toFixed(0)} | +10% → ${sensitivity.rentPlus10.toFixed(0)}</li><li>If OpEx changes: -10% → ${sensitivity.opExMinus10.toFixed(0)} | +10% → ${sensitivity.opExPlus10.toFixed(0)}</li></ul></div></div>)}
          </div>
        );
      };

      // --- Page Specific Component ---
      const NoiBuilderPage = () => {
        const [grossRent, setGrossRent] = useState('120000');
        const [vacancy, setVacancy] = useState('6000');
        const [otherIncome, setOtherIncome] = useState('5000');
        const [opEx, setOpEx] = useState('44000');
        
        useEffect(() => {
            const params = new URLSearchParams(window.location.search);
            if (params.get('rent')) setGrossRent(params.get('rent'));
            if (params.get('vacancy')) setVacancy(params.get('vacancy'));
            if (params.get('other')) setOtherIncome(params.get('other'));
            if (params.get('opex')) setOpEx(params.get('opex'));
        }, []);

        const noi = useMemo(() => {
          const numGrossRent = parseFloat(grossRent) || 0;
          const numVacancy = parseFloat(vacancy) || 0;
          const numOtherIncome = parseFloat(otherIncome) || 0;
          const numOpEx = parseFloat(opEx) || 0;
          return numGrossRent - numVacancy + numOtherIncome - numOpEx;
        }, [grossRent, vacancy, otherIncome, opEx]);
        
        const faqs = [ { question: "How do I calculate NOI?", answer: "The formula is: Gross Potential Rent - Vacancy Loss + Other Income - Operating Expenses. It represents the property's income before debt service and income taxes." }, { question: "What expenses are included in NOI?", answer: "Operating expenses include property taxes, insurance, maintenance, repairs, utilities, and property management fees. It excludes mortgage payments (principal and interest), capital expenditures (e.g., new roof), depreciation, and income taxes." }, { question: "Why is NOI so important for investors?", answer: "NOI is the primary figure used to determine a property's value and profitability. Lenders use it to calculate the Debt Service Coverage Ratio (DSCR) for loan approval, and investors use it to calculate the Capitalization Rate (Cap Rate) to determine a property's market value." }, ];

        return (
            <div className="bg-gray-50 text-gray-800 min-h-screen">
                <HeaderAndNav activePage="Calculators" />
                <main className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
                     <nav className="text-sm mb-4" aria-label="Breadcrumb"><ol className="list-none p-0 inline-flex">
                        <li className="flex items-center"><a href="index.html" className="text-gray-500 hover:text-blue-600">Home</a><svg className="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></li>
                        <li><span className="text-gray-700 font-medium">NOI Builder</span></li></ol>
                    </nav>

                    <h1 className="text-3xl md:text-4xl font-bold text-gray-900">NOI Builder</h1>
                     <div className="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-2">
                            <NoiBuilder grossRent={grossRent} setGrossRent={setGrossRent} vacancy={vacancy} setVacancy={setVacancy} otherIncome={otherIncome} setOtherIncome={setOtherIncome} opEx={opEx} setOpEx={setOpEx} noi={noi} />
                            
                            <div className="mt-6 bg-white p-6 rounded-lg border border-gray-200">
                                <h3 className="text-xl font-bold text-gray-900">💰 Understanding Your NOI</h3>
                                <div className="mt-4 space-y-2 text-gray-700">
                                    <ul className="list-disc list-inside space-y-1 pl-2 text-sm text-gray-600">
                                        <li><strong>{noi >= 0 ? 'Positive NOI' : 'Negative NOI'}:</strong> {noi >=0 ? 'Property generates income after operating expenses ✓' : 'Property expenses exceed income X'}</li>
                                        <li><strong>Higher NOI:</strong> More attractive to lenders and better cash flow potential.</li>
                                        <li><strong>Key Metric:</strong> NOI is used to calculate Cap Rate, DSCR, and property valuation.</li>
                                        <li><strong>Expense Ratios:</strong> Typical expense ratios are 35-45% of gross income for most property types.</li>
                                    </ul>
                                </div>
                            </div>

                            <div className="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded-md">
                                <p><strong className="font-semibold text-blue-800">💡 Pro Tip:</strong> Use actual expenses from the past 12 months when possible. Seller-provided 'pro forma' numbers are often optimistic. Always request T-12 (trailing twelve months) financial statements during due diligence.</p>
                            </div>

                            <div className="mt-8 prose max-w-none text-gray-700 bg-white p-6 rounded-lg border border-gray-200">
                                <h2 className="text-2xl font-bold text-gray-900">What is Net Operating Income (NOI)?</h2>
                                <p>Net Operating Income (NOI) is a calculation used to analyze the profitability of income-generating real estate investments. NOI equals all revenue from the property, minus all reasonably necessary operating expenses. NOI is a before-tax figure, appearing on a property’s income and cash flow statement, that excludes principal and interest payments on loans, capital expenditures, depreciation, and amortization. When this metric is used in other industries, it is referred to as "EBIT" (earnings before interest and taxes).</p>
                                <h3>What's Included and Excluded?</h3>
                                <p>The formula is straightforward: <strong>NOI = (Gross Operating Income + Other Income) - Operating Expenses</strong>. It's critical to understand what constitutes an operating expense. These are the day-to-day costs of running the property.</p>
                                <ul>
                                    <li><strong>Included in OpEx:</strong> Property taxes, insurance, property management fees, utilities, repairs, maintenance, administrative costs, and supplies.</li>
                                    <li><strong>Excluded from OpEx:</strong> Mortgage principal and interest, capital expenditures (e.g., replacing a roof, HVAC system), income taxes, and depreciation. These are considered "below the line" costs related to financing and ownership structure, not the property's operational performance itself.</li>
                                </ul>
                                <h3>Why NOI Matters</h3>
                                <p>NOI is arguably the most important number in a commercial property's financial statement. It is the basis for several other critical calculations. Lenders heavily rely on NOI to determine the Debt Service Coverage Ratio (DSCR), which assesses the property's ability to cover its loan payments. A higher, stable NOI makes it easier to secure financing on favorable terms. For investors, NOI is the numerator in the cap rate formula (Cap Rate = NOI / Property Value), which is used to value the property and compare it against other investment opportunities. A clear and accurate NOI calculation is the foundation of a sound real estate investment analysis.</p>
                            </div>

                            <div className="mt-8 bg-white p-6 rounded-lg border border-gray-200">
                                <h3 className="text-2xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h3>
                                <div className="space-y-3 border-t border-gray-200 divide-y divide-gray-200">
                                    {faqs.map((faq, index) => <AccordionItem key={index} question={faq.question} answer={faq.answer} />)}
                                </div>
                            </div>
                        </div>

                        <aside className="space-y-6">
                            <AdPlaceholder widthClass="w-[300px]" heightClass="h-[250px]" />
                            <AffiliateCard title="Compare Lenders" description="Find the best financing options." cta="Compare lenders" />
                            <AdPlaceholder widthClass="w-[300px]" heightClass="h-[250px]" />
                            <AffiliateCard title="Property Management Suite" description="Streamline your operations." cta="Free trial" />
                        </aside>
                    </div>
                    <div className="mt-8"><AdPlaceholder widthClass="w-full max-w-[728px]" heightClass="h-[90px]" /></div>
                </main>
                <Footer />
            </div>
        );
      };
      
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<NoiBuilderPage />);
    </script>
</body>
</html>
